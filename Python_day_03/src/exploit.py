from bs4 import BeautifulSoup


def main() -> None:
    with open("html/evilcorp.html", "r") as file:
        soup = BeautifulSoup(file, 'lxml')
        change_title(soup)
        add_header(soup)
        add_script(soup)
        change_link(soup)
        make_new_file(soup)


def change_title(soup: BeautifulSoup) -> None:
    soup.title.string = "Evil Corp - Stealing your money every day"


def add_header(soup: BeautifulSoup):
    name = soup.find('span', class_='name').text
    new_tag = soup.new_tag("h1")
    new_tag.string = f"{name}, you are hacked!"
    soup.find('body').insert(1, new_tag)


def add_script(soup: BeautifulSoup) -> None:
    script = soup.new_tag('script')
    script.string = """hacked = function() {
            alert('hacked');
        }
        window.addEventListener('load', 
          function() { 
            var f = document.querySelector("form");
            f.setAttribute("onsubmit", "hacked()");
          },
          false
        );"""
    soup.find("body").append(script)


def change_link(soup: BeautifulSoup) -> None:
    link = soup.find("a")
    link["href"] = "https://mrrobot.fandom.com/wiki/Fsociety"
    link.string = "Fsociety"


def make_new_file(soup: BeautifulSoup) -> None:
    with open("html/evilcorp_hacked.html", "w") as file:
        file.write(str(soup))


if __name__ == "__main__":
    main()
